<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF8">
  <title>Visualizing 83K games of MTG BFZ</title>

  <script type="text/javascript" src="http://visjs.org/dist/vis.js"></script>
  <link type="text/css" rel="stylesheet" href="http://visjs.org/dist/vis.css">

  <script src="nodes.js"></script>
  <script src="edges.js"></script>

  <style type="text/css">
  html, body {
    width: 100%;
    height: 100%;
    margin: 0;
    position: relative;
    background: rgb(230,230,230);
  }
  #mtg-network {
    float:left;
    width: 62%;
    height: 100%;
  }
  #config {
    float:left;
    width: 38%;
  }
  #progress {
    position: absolute;
    z-index: 2;
    width: 4em;
    height: 4em;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    margin: auto;
  }
  </style>
</head>
<body>
  <div id="mtg-network"></div>
  <div id="config"></div>
  <div id="progress"></div>

  <script type="text/javascript">
  var options = {
    groups: {
      'x': {
        color: 'gray',
        image: "symbol_x.svg",
        // font: {
        //   color: 'gray',
        // },
      },
      'w': {
        color: 'white',
        image: "symbol_w.svg",
        // font: {
        //   color: 'white',
        // },
      },
      'u': {
        color: 'blue',
        image: "symbol_u.svg",
        // font: {
        //   color: 'blue',
        // },
      },
      'b': {
        color: 'black',
        image: "symbol_b.svg",
        // font: {
        //   color: 'black',
        // },
      },
      'r': {
        color: 'red',
        image: "symbol_r.svg",
        // font: {
        //   color: 'red',
        // },
      },
      'g': {
        color: 'green',
        image: "symbol_g.svg",
        // font: {
        //   color: 'green',
        // },
      },
      'wu': {
        color: 'gold',
        image: "symbol_w_or_u.svg",
        // font: {
        //   color: 'gold',
        // },
      },
      'ub': {
        color: 'gold',
        image: "symbol_u_or_b.svg",
        // font: {
        //   color: 'gold',
        // },
      },
      'br': {
        color: 'gold',
        image: "symbol_b_or_r.svg",
        // font: {
        //   color: 'gold',
        // },
      },
      'rg': {
        color: 'gold',
        image: "symbol_r_or_g.svg",
        // font: {
        //   color: 'gold',
        // },
      },
      'gw': {
        color: 'gold',
        image: "symbol_g_or_w.svg",
        // font: {
        //   color: 'gold',
        // },
      },
      'wb': {
        color: 'gold',
        image: "symbol_w_or_b.svg",
        // font: {
        //   color: 'gold',
        // },
      },
      'ur': {
        color: 'gold',
        image: "symbol_u_or_r.svg",
        // font: {
        //   color: 'gold',
        // },
      },
      'bg': {
        color: 'gold',
        image: "symbol_b_or_g.svg",
        // font: {
        //   color: 'gold',
        // },
      },
      'rw': {
        color: 'gold',
        image: "symbol_r_or_w.svg",
        // font: {
        //   color: 'gold',
        // },
      },
      'gu': {
        color: 'gold',
        image: "symbol_g_or_u.svg",
        // font: {
        //   color: 'gold',
        // },
      },
    },
    nodes: {
      borderWidth: 0,
      font: {
        size: 14,
        strokeWidth: 2,
        strokeColor: 'rgb(230,230,230)',
      },
      scaling: {
        min: 9,
        max: 30,
        customScalingFunction: function (min,max,total,value) {
          return 2 * (value - .5);
        },
        label: {
          enabled: false,
        },
      },
      shape: 'circularImage',
      shadow: false,
    },
    edges: {
      color: {
        inherit: 'both',
      },
      font: {
        size: 9,
        strokeWidth: 2,
        strokeColor: 'rgb(230,230,230)',
      },
      scaling: {
        min: 0,
        max: 60,
        customScalingFunction: function (min,max,total,value) {
          return 2 * (value - .61803398875);
        },
        label: {
          enabled: false,
        },
      },
      hoverWidth: 2,
      selectionWidth: 4,
      smooth: {
        enabled: true,
        type: 'dynamic',
      },
    },
    configure: {
      filter: 'physics',
      container: document.getElementById('config')
    },
    interaction: {
      hideEdgesOnDrag: false,
      hover: true,
      hoverConnectedEdges: true,
      multiselect: false,
    },
    layout: {
      improvedLayout: false,
    },
    physics: {
      solver: 'barnesHut',
      barnesHut: {
        // gravitationalConstant: -4000,
        // centralGravity: .6,
        // springConstant: 0.95,
        avoidOverlap: .1,
      },
      stabilization: {
        enabled: true,
      },
    },
  };
  var container = document.getElementById('mtg-network');
  var allNodes;
  var highlightActive = false;
  var nodesDataset = new vis.DataSet(nodes);
  var data = {
    nodes: nodesDataset,
    edges: edges
  };
  var network = new vis.Network(container, data, options);

  // get a JSON object
  allNodes = nodesDataset.get({returnType:"Object"});

  network.on("stabilizationProgress", function(params) {
    document.getElementById('progress').innerHTML
        = Math.round(100 * params.iterations / params.total) + '%';
  });
  network.once("stabilizationIterationsDone", function() {
    setTimeout(function () {document.getElementById('progress').style.display = 'none';}, 500);
  });

  network.on("click", function(params) {
    // if something is selected:
    if (params.nodes.length > 0) {
      highlightActive = true;
      var i,j;
      var selectedNode = params.nodes[0];
      var degrees = 2;

      // mark all nodes as hard to read.
      for (var nodeId in allNodes) {
        allNodes[nodeId].color = 'rgba(200,200,200,0.38)';
        if (allNodes[nodeId].hiddenLabel === undefined) {
          allNodes[nodeId].hiddenLabel = allNodes[nodeId].label;
          allNodes[nodeId].label = undefined;
        }
      }
      var connectedNodes = network.getConnectedNodes(selectedNode);
      var allConnectedNodes = [];

      // get the second degree nodes
      for (i = 1; i < degrees; i++) {
        for (j = 0; j < connectedNodes.length; j++) {
          allConnectedNodes = allConnectedNodes.concat(network.getConnectedNodes(connectedNodes[j]));
        }
      }

      // all second degree nodes get a different color and their label back
      for (i = 0; i < allConnectedNodes.length; i++) {
        allNodes[allConnectedNodes[i]].color = 'rgba(150,150,150,0.62)';
        if (allNodes[allConnectedNodes[i]].hiddenLabel !== undefined) {
          allNodes[allConnectedNodes[i]].label = allNodes[allConnectedNodes[i]].hiddenLabel;
          allNodes[allConnectedNodes[i]].hiddenLabel = undefined;
        }
      }

      // all first degree nodes get their own color and their label back
      for (i = 0; i < connectedNodes.length; i++) {
        allNodes[connectedNodes[i]].color = undefined;
        if (allNodes[connectedNodes[i]].hiddenLabel !== undefined) {
          allNodes[connectedNodes[i]].label = allNodes[connectedNodes[i]].hiddenLabel;
          allNodes[connectedNodes[i]].hiddenLabel = undefined;
        }
      }

      // the main node gets its own color and its label back.
      allNodes[selectedNode].color = undefined;
      if (allNodes[selectedNode].hiddenLabel !== undefined) {
        allNodes[selectedNode].label = allNodes[selectedNode].hiddenLabel;
        allNodes[selectedNode].hiddenLabel = undefined;
      }
    }
    else if (highlightActive === true) {
      // reset all nodes
      for (var nodeId in allNodes) {
        allNodes[nodeId].color = undefined;
        if (allNodes[nodeId].hiddenLabel !== undefined) {
          allNodes[nodeId].label = allNodes[nodeId].hiddenLabel;
          allNodes[nodeId].hiddenLabel = undefined;
        }
      }
      highlightActive = false
    }

    // transform the object into an array
    var updateArray = [];
    for (nodeId in allNodes) {
      if (allNodes.hasOwnProperty(nodeId)) {
        updateArray.push(allNodes[nodeId]);
      }
    }
    nodesDataset.update(updateArray);
  });
  </script>
</body>
</html>
